<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AJ Lab Universal Pro</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0d1117">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Nunito:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00ffcc; --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #e6edf3; --accent: #238636; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; padding: 0; padding-bottom: 80px; user-select: none; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { background: #1f242c; padding: 15px; text-align: center; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .logo { font-family: 'Nunito', sans-serif; font-size: 1.8rem; color: var(--primary); margin: 0; text-shadow: 0 0 10px rgba(0,255,204,0.4); }
        .status-badge { font-size: 0.7rem; background: var(--accent); padding: 2px 8px; border-radius: 10px; color: white; vertical-align: middle; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Vision & Input) */
        .ops-room { padding: 15px; }
        .vision-box { background: #000; border-radius: 15px; overflow: hidden; position: relative; border: 1px solid var(--border); display: none; margin-bottom: 10px; }
        video { width: 100%; height: 250px; object-fit: cover; }
        .capture-overlay { position: absolute; bottom: 10px; left: 0; right: 0; text-align: center; }
        .btn-capture { background: white; width: 60px; height: 60px; border-radius: 50%; border: 4px solid rgba(0,0,0,0.2); cursor: pointer; }

        .chat-box { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 10px; display: flex; gap: 8px; align-items: center; }
        textarea { flex: 1; background: transparent; border: none; color: white; font-family: 'Cairo'; font-size: 1rem; resize: none; outline: none; height: 40px; }
        .icon-btn { background: transparent; border: none; font-size: 1.4rem; cursor: pointer; padding: 5px; transition: 0.2s; }
        .icon-btn:active { transform: scale(0.8); }

        /* Ø±Ø¯ Ø§Ù„Ø£Ø³Ø·Ù‰ */
        #ai-response { margin: 15px; padding: 15px; background: rgba(0, 255, 204, 0.05); border-right: 4px solid var(--primary); border-radius: 8px; display: none; line-height: 1.6; font-size: 0.95rem; white-space: pre-wrap; }
        .tools-row { display: flex; gap: 10px; margin-top: 10px; justify-content: flex-end; }
        .btn-tool { font-size: 0.8rem; padding: 5px 10px; background: var(--card); border: 1px solid var(--border); color: var(--text); border-radius: 5px; cursor: pointer; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± (The Grid) */
        .section-title { padding: 10px 20px; font-weight: bold; color: #8b949e; font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; }
        .grid-50 { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 8px; padding: 0 15px; }
        .app-btn { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 15px 5px; text-align: center; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .app-btn:active { background: var(--primary); transform: scale(0.95); border-color: var(--primary); }
        .app-btn span { font-size: 1.5rem; }
        .app-btn small { font-size: 0.7rem; font-weight: 700; color: #c9d1d9; }
        .app-btn:active small { color: #000; }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #161b22; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; }
        .nav-item { color: #8b949e; text-align: center; font-size: 0.7rem; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.2rem; display: block; margin-bottom: 2px; }

        /* ÙƒØ§Ù†ÙØ§Ø³ Ù…Ø®ÙÙŠ Ù„Ù„ØµÙˆØ± */
        canvas { display: none; }
    </style>
</head>
<body>

    <div class="header">
        <h1 class="logo">AJ Lab <span style="font-size:1rem; color:white;">Universal</span></h1>
        <div style="font-size: 0.7rem; margin-top:5px; opacity:0.8;">
            Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø´Ø§Ù…Ù„ | <span class="status-badge">Pro Online</span>
        </div>
    </div>

    <div id="view-home">
        <div class="ops-room">
            <div class="vision-box" id="visionBox">
                <video id="videoFeed" autoplay playsinline></video>
                <div class="capture-overlay"><button class="btn-capture" onclick="captureImage()"></button></div>
            </div>
            
            <div class="chat-box">
                <button class="icon-btn" onclick="toggleCamera()">ğŸ“·</button>
                <button class="icon-btn" onclick="startDictation()">ğŸ¤</button>
                <textarea id="mainInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ø·Ù„ Ø£Ùˆ ØµÙˆØ±Ù‡..."></textarea>
                <button class="icon-btn" style="color:var(--primary);" onclick="executeAI()">ğŸš€</button>
            </div>
        </div>

        <div id="ai-response"></div>

        <div class="section-title">
            <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (50 ÙˆØ¸ÙŠÙØ©)</span>
            <span style="font-size:0.7rem; color:var(--primary);">v3.0</span>
        </div>
        <div class="grid-50" id="appsGrid"></div>
        <div style="height: 20px;"></div>
    </div>

    <div id="view-log" style="display:none; padding:15px;">
        <h3 style="color:var(--primary);">Ø¯ÙØªØ± Ø§Ù„ÙˆØ±Ø´Ø©</h3>
        <div id="logList" style="display:flex; flex-direction:column; gap:10px;"></div>
        <button class="btn-tool" style="width:100%; margin-top:20px;" onclick="clearLog()">Ù…Ø³Ø­ Ø§Ù„Ø¯ÙØªØ±</button>
    </div>

    <canvas id="snapshot"></canvas>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchView('home')"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="nav-item" onclick="switchView('log')"><i>ğŸ“‹</i>Ø§Ù„Ø¯ÙØªØ±</div>
        <div class="nav-item" onclick="toggleVoiceMode()" id="voiceToggle"><i>ğŸ”Š</i>Ø§Ù„ØµÙˆØª: ØªØ´ØºÙŠÙ„</div>
    </div>

    <script>
        // --- Configuration ---
        const API_KEY = "AIzaSyDSEanlwCKhNGvp4zwGksuk5Vgr_qMZ0TM";
        let isVoiceEnabled = true;
        let currentImageBase64 = null;

        // --- Data: The 50 Professional Buttons ---
        const apps = [
            // Moto
            {n:"Ø¨ÙˆÙ„Ø³Ø§Ø± 180", i:"ğŸï¸", p:"Ø£Ø¹Ø·Ø§Ù„ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§ ÙˆÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø¨ÙˆÙ„Ø³Ø§Ø± 180"}, 
            {n:"Ø¨ÙˆÙƒØ³Ø± 150", i:"âš™ï¸", p:"Ø£Ø¹Ø·Ø§Ù„ Ø¨ÙˆÙƒØ³Ø± 150 (5 ØºÙŠØ§Ø± Ùˆ4 ØºÙŠØ§Ø±)"}, 
            {n:"ØµÙŠÙ†ÙŠ 200", i:"ğŸ§§", p:"Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„Ø§Øª ØµÙŠÙ†ÙŠ 150 Ùˆ 200 Ø³ÙŠ Ø³ÙŠ"},
            {n:"Ø³ÙƒÙˆØªØ±", i:"ğŸ›µ", p:"Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ø³ÙƒÙˆØªØ± ÙˆØ§Ù„Ø³ÙŠ ÙÙŠ ØªÙŠ"},
            // Printing
            {n:"Ù‡Ø§ÙŠØ¯Ù„Ø¨ÙŠØ±Ø¬", i:"ğŸ“ ", p:"Ø£Ø¹Ø·Ø§Ù„ Ù…Ø§ÙƒÙŠÙ†Ø© Ø·Ø¨Ø§Ø¹Ø© Ù‡Ø§ÙŠØ¯Ù„Ø¨ÙŠØ±Ø¬ Ø£ÙˆÙØ³Øª"},
            {n:"GTO 52", i:"ğŸ‡©ğŸ‡ª", p:"ØµÙŠØ§Ù†Ø© Ù…Ø§ÙƒÙŠÙ†Ø© GTO"},
            {n:"Ù…Ù‚Øµ ÙˆØ±Ù‚", i:"âœ‚ï¸", p:"Ø£Ø¹Ø·Ø§Ù„ Ù…Ù‚Øµ Ø§Ù„ÙˆØ±Ù‚ Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆÙ„ÙŠÙƒ"},
            {n:"Ø£Ø­Ø¨Ø§Ø±", i:"ğŸ¨", p:"Ù…Ø´Ø§ÙƒÙ„ Ø®Ù„Ø· Ø§Ù„Ø£Ø­Ø¨Ø§Ø± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©"},
            // Appliances
            {n:"ØºØ³Ø§Ù„Ø© Ø£ÙˆØªÙˆ", i:"ğŸ§º", p:"ØºØ³Ø§Ù„Ø§Øª ÙÙˆÙ„ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ ÙˆØªÙˆØ´ÙŠØ¨Ø§"},
            {n:"Ø³Ø®Ø§Ù† ØºØ§Ø²", i:"ğŸ”¥", p:"Ø³Ø®Ø§Ù†Ø§Øª ØºØ§Ø² ÙˆÙƒÙ‡Ø±Ø¨Ø§Ø¡"},
            {n:"Ø«Ù„Ø§Ø¬Ø©", i:"â„ï¸", p:"Ø«Ù„Ø§Ø¬Ø§Øª Ù†ÙˆÙØ±ÙˆØ³Øª ÙˆØ¯ÙŠÙØ±ÙˆØ³Øª"},
            {n:"ØªÙƒÙŠÙŠÙ", i:"ğŸŒ¬ï¸", p:"Ø£Ø¹Ø·Ø§Ù„ ØªÙƒÙŠÙŠÙ Ø³Ø¨Ù„ÙŠØª ÙˆØ´Ø¨Ø§Ùƒ"},
            // POS & Tech
            {n:"POS Ø³ÙŠØ³ØªÙ…", i:"ğŸ“Š", p:"Ù…Ø´Ø§ÙƒÙ„ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙˆØ§Ù„Ø¨ÙŠØ¹"},
            {n:"Ø·Ø§Ø¨Ø¹Ø© Ø±ÙŠØ³ÙŠØª", i:"ğŸ§¾", p:"Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©"},
            {n:"Ø¨Ø§Ø±ÙƒÙˆØ¯", i:"ğŸ·ï¸", p:"Ø£Ø¬Ù‡Ø²Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯"},
            {n:"Ù…ÙŠØ²Ø§Ù†", i:"âš–ï¸", p:"Ù…ÙˆØ§Ø²ÙŠÙ† Ø¯ÙŠØ¬ÙŠØªØ§Ù„ ÙˆØ¨Ø±Ù…Ø¬ØªÙ‡Ø§"},
            // Parts & Tools
            {n:"Ø¨ÙˆØ¬ÙŠÙ‡Ø§Øª", i:"ğŸ•¯ï¸", p:"Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙˆØ¬ÙŠÙ‡Ø§Øª ÙˆØ¶Ø¨Ø·Ù‡Ø§"},
            {n:"ÙƒØ±Ø¨Ø±Ø§ØªÙŠØ±", i:"â›½", p:"Ø¶Ø¨Ø· ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒØ±Ø¨Ø±Ø§ØªÙŠØ±"},
            {n:"Ø¯Ø¨Ø±ÙŠØ§Ø¬", i:"â›“ï¸", p:"Ù…Ø´Ø§ÙƒÙ„ ÙˆØ±Ù‚ Ø§Ù„Ø¯Ø¨Ø±ÙŠØ§Ø¬"},
            {n:"Ø¨Ø·Ø§Ø±ÙŠØ§Øª", i:"ğŸ”‹", p:"Ù‚ÙŠØ§Ø³ ÙˆØµÙŠØ§Ù†Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ§Øª"},
            {n:"Ø¹Ù…Ø±Ø© Ù…ÙˆØªÙˆØ±", i:"ğŸ”§", p:"Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ø±Ø© Ø§Ù„Ù…ÙˆØªÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„Ø©"},
            {n:"ØªØºÙŠÙŠØ± Ø²ÙŠØª", i:"ğŸ›¢ï¸", p:"Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø²ÙŠÙˆØª ÙˆÙÙ„Ø§ØªØ± Ø§Ù„Ø²ÙŠØª"},
            {n:"ÙƒØ§ÙˆØªØ´", i:"ğŸ©", p:"Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¬Ù†Ø· ÙˆØ§Ù„ÙƒØ§ÙˆØªØ´ Ø§Ù„ØªÙŠÙˆØ¨Ù„Ø³"},
            {n:"ÙØ±Ø§Ù…Ù„", i:"ğŸ›‘", p:"ØªÙŠÙ„ Ø§Ù„ÙØ±Ø§Ù…Ù„ ÙˆØ§Ù„Ø¨Ø§ÙƒÙ…"},
            // Home Tech
            {n:"Ø±Ø§ÙˆØªØ±", i:"ğŸŒ", p:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø§ÙˆØªØ± ÙˆØ§Ù„Ø¥Ù†ØªØ±Ù†Øª"},
            {n:"Ø´Ø§Ø´Ø© LED", i:"ğŸ“º", p:"Ø£Ø¹Ø·Ø§Ù„ Ø´Ø§Ø´Ø§Øª ÙˆØ±ÙŠØ³ÙŠÙØ±"},
            {n:"Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ", i:"ğŸ±", p:"Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ"},
            {n:"Ø®Ù„Ø§Ø·", i:"ğŸŒªï¸", p:"ØµÙŠØ§Ù†Ø© Ø§Ù„Ø®Ù„Ø§Ø·Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ§ØªÙŠØ± Ø§Ù„ØµØºÙŠØ±Ø©"},
            {n:"Ù…ÙƒÙˆØ§Ø©", i:"ğŸ’¨", p:"Ù…ÙƒÙˆØ§Ø© Ø¨Ø®Ø§Ø± ÙˆÙƒØ§Ø¨Ø³"},
            {n:"Ù…Ø±ÙˆØ­Ø©", i:"ğŸŒ€", p:"Ù…Ø±Ø§ÙˆØ­ Ø³Ù‚Ù ÙˆØ¹Ù…ÙˆØ¯"},
            {n:"Ø´ÙØ§Ø·", i:"ğŸ ", p:"Ø´ÙØ§Ø·Ø§Øª Ù…Ø·Ø¨Ø® ÙˆØ­Ù…Ø§Ù…"},
            {n:"ÙƒØ§ØªÙ„", i:"â˜•", p:"ØºÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ÙŠØ§Ù‡"},
            // Advanced
            {n:"ÙƒÙ…Ø¨Ø±ÙˆØ³Ø±", i:"ğŸ’¨", p:"ÙƒÙ…Ø¨Ø±ÙˆØ³Ø± Ù‡ÙˆØ§Ø¡ ÙˆØ¶ØºØ·"},
            {n:"Ø·Ù„Ù…Ø¨Ø© Ù…ÙŠØ§Ù‡", i:"ğŸ’§", p:"Ù…ÙˆØ§ØªÙŠØ± Ø±ÙØ¹ Ø§Ù„Ù…ÙŠØ§Ù‡"},
            {n:"Ù…ÙˆÙ„Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡", i:"âš¡", p:"Ù…ÙˆÙ„Ø¯Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†"},
            {n:"Ù…Ø§ÙƒÙŠÙ†Ø© Ù„Ø­Ø§Ù…", i:"ğŸ’¥", p:"Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ø§Ù„Ù„Ø­Ø§Ù… Ø§Ù„Ø§Ù†ÙØ±ØªØ±"},
            // Office
            {n:"Ø·Ø§Ø¨Ø¹Ø© Ù„ÙŠØ²Ø±", i:"ğŸ–¨ï¸", p:"Ø·Ø§Ø¨Ø¹Ø§Øª HP Ùˆ Canon"},
            {n:"Ù…Ø§ÙƒÙŠÙ†Ø© ØªØµÙˆÙŠØ±", i:"ğŸ“·", p:"Ù…Ø§ÙƒÙŠÙ†Ø§Øª ØªØµÙˆÙŠØ± Ø±ÙŠÙƒÙˆ ÙˆØ²ÙŠØ±ÙˆÙƒØ³"},
            {n:"Ø­Ø¨Ø§Ø±Ø©", i:"âš«", p:"Ù…Ù„Ø¡ ÙˆØµÙŠØ§Ù†Ø© Ø§Ù„ÙƒØ§Ø±ØªØ±ÙŠØ¬"},
            {n:"Ø³ÙƒØ§Ù†Ø±", i:"ğŸ”", p:"Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ù…Ø§Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ"},
            // Management
            {n:"Ø¬Ø±Ø¯ Ù…Ø®Ø²Ù†", i:"ğŸ“¦", p:"Ø·Ø±ÙŠÙ‚Ø© Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø§Ø²Ù†"},
            {n:"Ø­Ø³Ø§Ø¨ ÙŠÙˆÙ…ÙŠØ©", i:"ğŸ’°", p:"ØªÙ‚ÙÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©"},
            {n:"Ø£Ø±Ø¨Ø§Ø­", i:"ğŸ“ˆ", p:"Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±"},
            {n:"Ø¹Ù…Ù„Ø§Ø¡", i:"ğŸ‘¥", p:"Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"},
            // Expert Modes
            {n:"Ù…Ø±ÙŠÙ… Ù…ÙŠÙƒØ³", i:"ğŸ²", p:"Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙˆØµÙØ§Øª Ø·Ø¹Ø§Ù…"},
            {n:"ÙˆÙ„ÙŠØ¯ Ø¹Ù„ÙŠ", i:"ğŸ‘¨â€ğŸ”§", p:"ØªØ´Ø®ÙŠØµ Ø£Ø¹Ø·Ø§Ù„ Ø¨Ø§Ù„ØµÙˆØª"},
            {n:"ØµÙŠØ§Ù†Ø© ÙˆÙ‚Ø§Ø¦ÙŠØ©", i:"ğŸ›¡ï¸", p:"Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©"},
            {n:"Google Cloud", i:"â˜ï¸", p:"Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø¬ÙˆØ¬Ù„ ÙƒÙ„Ø§ÙˆØ¯"},
            {n:"ÙƒÙˆØ¯ Ø£Ø¹Ø·Ø§Ù„", i:"ğŸ”¢", p:"Ø´Ø±Ø­ Ø£ÙƒÙˆØ§Ø¯ Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ÙˆØ§Ù„Ù…ÙƒÙ†"}
        ];

        // --- Initialization ---
        window.onload = function() {
            renderGrid();
            renderLog();
        };

        function renderGrid() {
            const grid = document.getElementById('appsGrid');
            grid.innerHTML = '';
            apps.forEach(app => {
                const div = document.createElement('div');
                div.className = 'app-btn';
                div.innerHTML = `<span>${app.i}</span><small>${app.n}</small>`;
                div.onclick = () => {
                    document.getElementById('mainInput').value = `Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ${app.p}: `;
                    executeAI();
                };
                grid.appendChild(div);
            });
        }

        // --- Core Functions ---

        async function executeAI() {
            const input = document.getElementById('mainInput').value;
            if (!input && !currentImageBase64) return;

            const outDiv = document.getElementById('ai-response');
            outDiv.style.display = 'block';
            outDiv.innerHTML = 'â³ <strong>Ø§Ù„Ø£Ø³Ø·Ù‰ AJ Lab Ø¨ÙŠØ´Ø®Øµ Ø§Ù„Ø¹Ø·Ù„...</strong>';

            // Prepare prompt
            let parts = [
                { text: `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ "Ø£Ø³Ø·Ù‰" ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ AJ Lab. ØªØ®ØµØµÙƒ: Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§ØŒ Ø·Ø¨Ø§Ø¹Ø©ØŒ Ø£Ø¬Ù‡Ø²Ø© Ù…Ù†Ø²Ù„ÙŠØ©ØŒ ÙˆØ¨Ø±Ù…Ø¬Ø©.
                ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…ÙŠØ© "Ø§Ù„ØµÙ†Ø§ÙŠØ¹ÙŠØ©". ÙƒÙ† Ù…Ø®ØªØµØ±Ø§Ù‹ ÙˆÙ…Ø¨Ø§Ø´Ø±Ø§Ù‹.
                1. Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©. 2. Ø§Ù„Ø¹Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©. 3. Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„ (Ù†Ù‚Ø§Ø·).
                Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${input}` }
            ];

            // If image exists, add it
            if (currentImageBase64) {
                parts.push({
                    inline_data: {
                        mime_type: "image/jpeg",
                        data: currentImageBase64
                    }
                });
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: parts }] })
                });

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                
                // Show result
                outDiv.innerHTML = `<strong>ğŸ› ï¸ Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong>\n${text}
                <div class="tools-row"><button class="btn-tool" onclick="saveToLog('${input}', 'ØªÙ… Ø§Ù„Ø­Ù„')">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¯ÙØªØ± ğŸ’¾</button></div>`;
                
                // Speak result
                if (isVoiceEnabled) speak(text);
                
                // Clear image after send
                currentImageBase64 = null;
                document.getElementById('visionBox').style.display = 'none';

            } catch (error) {
                outDiv.innerHTML = 'âŒ Ø­ØµÙ„ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø¬Ø±Ø¨ ØªØ§Ù†ÙŠ ÙŠØ§ Ù‡Ù†Ø¯Ø³Ø©.';
                console.error(error);
            }
        }

        // --- Hardware Interactions ---

        function toggleCamera() {
            const box = document.getElementById('visionBox');
            const video = document.getElementById('videoFeed');
            
            if (box.style.display === 'none' || !box.style.display) {
                box.style.display = 'block';
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                .then(stream => { video.srcObject = stream; })
                .catch(err => alert('Ù„Ø§Ø²Ù… ØªØ³Ù…Ø­ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ´ØªØºÙ„ ÙŠØ§ Ø¨Ø·Ù„!'));
            } else {
                box.style.display = 'none';
                if(video.srcObject) video.srcObject.getTracks().forEach(track => track.stop());
            }
        }

        function captureImage() {
            const video = document.getElementById('videoFeed');
            const canvas = document.getElementById('snapshot');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            // Get base64 without prefix
            const dataUrl = canvas.toDataURL('image/jpeg');
            currentImageBase64 = dataUrl.split(',')[1];
            
            // Visual feedback
            const btn = document.querySelector('.btn-capture');
            btn.style.background = '#00ffcc';
            setTimeout(() => { 
                btn.style.background = 'white'; 
                toggleCamera(); // Auto close camera
                document.getElementById('mainInput').value += " [ØªÙ… Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø©] ";
                executeAI(); // Auto send
            }, 500);
        }

        function startDictation() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'ar-EG';
            recognition.start();
            recognition.onresult = function(event) {
                document.getElementById('mainInput').value = event.results[0][0].transcript;
                executeAI();
            };
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ar-EG';
            window.speechSynthesis.speak(utterance);
        }

        // --- UI & Storage Logic ---

        function toggleVoiceMode() {
            isVoiceEnabled = !isVoiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.innerHTML = isVoiceEnabled ? '<i>ğŸ”Š</i>Ø§Ù„ØµÙˆØª: ØªØ´ØºÙŠÙ„' : '<i>ğŸ”‡</i>Ø§Ù„ØµÙˆØª: ØµØ§Ù…Øª';
            btn.style.color = isVoiceEnabled ? 'var(--primary)' : '#8b949e';
        }

        function switchView(viewName) {
            document.getElementById('view-home').style.display = viewName === 'home' ? 'block' : 'none';
            document.getElementById('view-log').style.display = viewName === 'log' ? 'block' : 'none';
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if(viewName === 'home') document.querySelectorAll('.nav-item')[0].classList.add('active');
            if(viewName === 'log') document.querySelectorAll('.nav-item')[1].classList.add('active');
        }

        function saveToLog(problem, status) {
            let logs = JSON.parse(localStorage.getItem('ajLabLogs')) || [];
            const date = new Date().toLocaleDateString('ar-EG');
            logs.unshift({ date, problem, status });
            localStorage.setItem('ajLabLogs', JSON.stringify(logs));
            renderLog();
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø¯ÙØªØ± ÙŠØ§ Ø±ÙŠØ³!');
        }

        function renderLog() {
            const list = document.getElementById('logList');
            const logs = JSON.parse(localStorage.getItem('ajLabLogs')) || [];
            list.innerHTML = '';
            if(logs.length === 0) list.innerHTML = '<div style="text-align:center; color:#666;">Ø§Ù„Ø¯ÙØªØ± ÙØ§Ø¶ÙŠ Ù„Ø³Ù‡..</div>';
            
            logs.forEach(log => {
                list.innerHTML += `
                <div style="background:#21262d; padding:10px; border-radius:8px; border-left:3px solid var(--accent);">
                    <div style="font-size:0.7rem; color:#8b949e;">${log.date}</div>
                    <div style="font-weight:bold;">${log.problem}</div>
                </div>`;
            });
        }

        function clearLog() {
            if(confirm('Ù…ØªØ£ÙƒØ¯ Ø¹Ø§ÙˆØ² ØªÙ…Ø³Ø­ Ø§Ù„Ø¯ÙØªØ± ÙƒÙ„Ù‡ØŸ')) {
                localStorage.removeItem('ajLabLogs');
                renderLog();
            }
        }
    </script>
</body>
</html>
